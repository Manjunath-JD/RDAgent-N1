hypothesis_gen:
  system: |-
    The user is working on generating new hypotheses for the {{targets}} in a data-driven research and development process. 
    The {{targets}} are used in the following scenario:
    {{scenario}}
    The user has already proposed several hypotheses and conducted evaluations on them. This information will be provided to you. Your task is to check whether a similar hypothesis has already been generated. 
    If one exists and you agree with it, feel free to use it. If you disagree, please generate an improved version.
    {% if hypothesis_specification %}
    To assist you in formulating new hypotheses, the user has provided some additional information: {{hypothesis_specification}}.
    **Important:** If the hypothesis_specification outlines the next steps you need to follow, ensure you adhere to those instructions.
    {% endif %}
    Please generate the output using the following format and specifications:
    {{ hypothesis_output_format }}

  user: |-
    {% if hypothesis_and_feedback|length == 0 %}It is the first round of hypothesis generation. The user has no hypothesis on this scenario yet.
    {% else %}It is not the first round, the user has made several hypothesis on this scenario and did several evaluation on them.
    The former hypothesis and the corresponding feedbacks are as follows (focus on the last one & the new hypothesis that it provides and reasoning to see if you agree):
    {{ hypothesis_and_feedback }}
    {% endif %}
    {% if RAG %}
    To assist you in generating new {{targets}}, we have provided the following information: {{RAG}}.
    **Note:** The provided RAG is for reference only. 
    You must carefully assess whether the RAG aligns with the {{targets}}. 
    If it does not, it should not be used. Exercise caution and make your own judgment.
    {% endif %}
    Also generate the relevant keys for the reasoning and the distilled knowledge that follows. For those keys, in particular for knowledge, explain in the context of the specific scenario to build up domain knowledge in the specific field rather than general knowledge.

task_gen:
  system: |-
    {% if hypothesis is not none %}
    The user is trying to generate new {{targets}} based on the hypothesis generated in the previous step. 
    {% else %}
    The user is trying to generate new {{targets}} based on the information provided. 
    {% endif %}
    The {{targets}} are used in certain scenario, the scenario is as follows:
    {{ scenario }}

    {% if hypothesis is not none %}
    The user will use the {{targets}} generated to do some experiments. The user will provide this information to you:
    1. The target hypothesis you are targeting to generate {{targets}} for.
    2. The hypothesis generated in the previous steps and their corresponding feedbacks.
    3. Former proposed {{targets}} on similar hypothesis.
    4. Some additional information to help you generate new {{targets}}.
    {% endif %}
    Please generate the output following the format below:
    {{ task_output_format }}
    
  user: |-
    {% if hypothesis is not none %}
    The user has made several hypothesis on this scenario and did several evaluation on them.
    The target hypothesis you are targeting to generate {{targets}} for is as follows:
    {{ hypothesis }}
    The former hypothesis and the corresponding feedbacks are as follows:
    {{ hypothesis_and_feedback }}
    Please generate the new {{targets}} based on the information above.
    {% else %}
    Please generate the new {{targets}} task.
    {% endif %}

hypothesis_and_feedback: |-
  {% for hypothesis, experiment, feedback in trace.hist[-10:] %}
  Hypothesis {{ loop.index }}: {{ hypothesis }}
  Observation on the result with the hypothesis: {{ feedback.observations }}
  Feedback on the original hypothesis:  {{ feedback.hypothesis_evaluation }}
  Did changing to this hypothesis work? (focus on the change):  {{ feedback.decision }}
  {% endfor %}

hypothesis_specification: |-
  Hypothesis should avoid being too general and vague, and should be specific and actionable. For example, hypothesis like 'tune a model' is too general, while hypothesis like 'increase the learning rate to 0.1 of the lightgbm model will improve the performance' is specific and actionable.
  Your hypothesis should based on current SOTA solution. The user will conduct experiments based on the SOTA solution to test whether your hypothesis is right on this specific competition.
  {{ sota_solution}}

output_format:
  hypothesis: |-
    The output should follow JSON format. The schema is as follows:
    {
      "component": "If "hypothesis_specification" provides the component you need to take, please follow "hypothesis_specification" to choose the component. Otherwise, based on previous experimental results, suggest the component you believe is most appropriate at the moment. It should be one of ["DataLoadSpec", "FeatureEng", "Model", "Ensemble", "Workflow"]",
      "hypothesis": "The new hypothesis generated based on the information provided.",
      "reason": "The reason why you generate this hypothesis. It should be comprehensive and logical. It should cover the other keys below and extend them.",
      "concise_reason": "Two-line summary. First line focuses on a concise justification for the change. Second line generalizes a knowledge statement.",
      "concise_observation": "One line summary. It focuses on the observation of the given scenario, data characteristics, or previous experiences (failures & succeses).",
      "concise_justification": "One line summary. Justify the hypothesis based on theoretical principles or initial assumptions.",
      "concise_knowledge": "One line summary. Transferable knowledge based on theoretical principles. Use conditional grammar. eg. "If...., ..; When..., .; and etc" Make sure that you state things clearly without ambiguity. Eg. avoid saying "previous hypothesis", because one wouldn't know what that is."
    }
  data_loader: |-
    According to the hypothesis, please help user design one data loader task.
    The output should follow JSON format. The schema is as follows:
    {
        "description": "description of the overall data loader for the data science workflow",
        # Don't add ellipsis (...) or any filler text that might cause JSON parsing errors here!
    }
  feature: |-
    According to the hypothesis, please help user design one or more feature engineering tasks.
    The output should follow JSON format. The schema is as follows:
    {
        "feature name 1": {
            "description": "description of feature name 1",
            "formulation": "latex formulation of feature or group name 1",
            "variables": {
                "variable or function name 1": "description of variable or function 1",
                "variable or function name 2": "description of variable or function 2"
            }
        },
        "feature name 2": {
            "description": "description of feature name 2",
            "formulation": "latex formulation of feature or group name 2",
            "variables": {
                "variable or function name 1": "description of variable or function 1",
                "variable or function name 2": "description of variable or function 2"
            }
        }
        # Don't add ellipsis (...) or any filler text that might cause JSON parsing errors here!
    }
  model: |-
    According to the hypothesis, please help user design one model task.
    The output should follow JSON format. The schema is as follows: 
    {
        "model_name": "model_name",
        "description": "A detailed description of the model",
        "architecture": "A detailed description of the model's architecture, e.g., neural network layers or tree structures",
        "hyperparameters": {
            "hyperparameter_name_1": "value of hyperparameter 1",
            "hyperparameter_name_2": "value of hyperparameter 2",
            "hyperparameter_name_3": "value of hyperparameter 3"
        },
    }
    Usually, a larger model works better than a smaller one. Hence, the parameters should be larger.
  ensemble: |-
    According to the hypothesis, please help user design one ensemble task.
    The output should follow JSON format. The schema is as follows:
    {
        "description": "A detailed description of the ensemble",
    }
  workflow: |-
    According to the hypothesis, please help user design one workflow task.
    The output should follow JSON format. The schema is as follows:
    {
        "description": "A detailed description of the workflow",
    }
